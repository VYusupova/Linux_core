


## Настройка gitlab-runner

##### 1. Поднять виртуальную машину *Ubuntu Server 22.04 LTS*.
##### 2. Скачай и установи на виртуальную машину *gitlab-runner*.  

<details>
<summary>  удаленное соединение  </summary>
 
Орагнизовать удаленное соединение: доступ в терминал виртуалки с хоста или любой другой виртуальной машины с интерфейсом, что бы вручную не вписывать команды регистарции у установки *gitlab-runner*  
-  в настройках виртуальной машины выбрать адптер сетевой мост.   
`ip a` - запросить адрес, по этому адресу пропинговать с другой машины пинг должен проходить, или с хоста так же проходит пинг

> Включить терминал можно комбинацией `Ctr+Alt+T`

 - проверим что `ssh` работает - `sudo systemctl status sshd`  
 - если не работет включить - `sudo apt-get install ssh` -  раскомитить 22 порт в файле `/etc/ssh/sshd_config`   
-  подключаться с удаленной машины командой - `ssh <username>@<ipname>` - ввесить пароль при запросе   
- установить `gitlab runner` `*https://docs.gitlab.com/runner/install/linux-repository/*`   

> `gitlab-runner status` - Проверяет статус работающего сервиса GitLab Runner.


</details>

##### 3 Запусти gitlab-runner и зарегистрируй его для использования в текущем проекте (DO6_CICD).

Для регистрации понадобятся URL и токен

<details>
<summary>  Регистрация GitLab Runner: </summary>

1. Запустите команду `gitlab-runner register`  
2. Введите `URL` вашего `GitLab` экземпляра  
3. Введите токен регистрации, который вы скопировали ранее  
4. Придумайте описание для вашего Runner'а. Это может быть что-то вроде "Linux Runner for project X".   
5. Введите теги для Runner'а (через запятую), если нужно. Теги используются для привязки Runner'а к конкретным задачам в вашем CI/CD.   
6. Можно добавить примечание по обслуживанию. Например, указать характеристики сервера. 
7. Выберите тип executor'а. Самые распространенные варианты:
shell: Задачи выполняются непосредственно на сервере, где установлен Runner. 
docker: Задачи выполняются в Docker контейнерах. 
Если выбрали docker, нужно будет указать образ, например, alpine. 

</details>

<details>
<summary> в картинках </summary>

![Настройка сети вируальной машины ](image/VM_network.png "Настройка сети вируальной машины ")  
  
![установка ssh при установке убунту](image/install_openSSH.png "установка ssh при установке убунту")  
  
![Возможные ошибки при запуске службы sshd](image/Error_sshd.png "Возможные ошибки при запуске службы sshd")  
  
![проверка статуса службы sshd](image/status_sshd.png "проверка статуса службы sshd")  
  
![результат подключения через sshd](image/ssh_doing_result.png "результат подключения через sshd")  
  
![установка gitlab-runner](image/install_gitlab_runner.png "установка gitlab-runner")  
  
![регистрация gitlab-runner](image/runner_register.png "регистрация gitlab-runner")  



</details>


<details>
<summary> комнды gitlab-runner </summary>
 
```bash
sudo systemctl status gitlab-runner  # проверка статуса
 
gitlab-runner run # Запуск всех раннеров

gitlab-runner list # Список раннеров  

gitlab-runner verify # Проверка раннеров

gitlab-runner unregister --all-runners # Удаление всех раннеров

gitlab-runner unregister --name ${name_runner} # Удаление конкретного раннера

vim /etc/gitlab-runner/config.toml # Файл с конфигурациями раннеров  
```

</details>


<details>
<summary> ТЕОРИЯ </summary>
 
Скрипт *CI* пишется на *YAML*. `.gitlab-ci.yml` - это единственный файл, который лежит непосредственно в корне проекта. В любых других папках *GitLab* его просто не прочитает, соответственно пайплайн работать не будет.  

Для отладки и для понимания пайплайна можно использовать средство, встроенное в саму оболочку `GitLab: Build -> Pipeline Editor`.  

> Перейдем в Pipeline editor, выберем ветку develop, и нажмем кнопку Configure pipeline. Мы попадем в окно визуального редактора. По идее, команды можно писать в файле .gitlab-ci.yml напрямую. Преимущества визуального редактора – он хорошо подсвечивает ошибки в yaml синтаксисе, и иногда дает базовые подсказки. В остальном – дело вкуса.  

Для визуальной и логической компоновки ваших Jobs, здесь есть так называемые стадии -stages. Не более чем группировка. В процессе работы pipeline – можно будет смотреть, какая стадия и какая jobs в ней выполняется.  

Руководство по разработке шаблонов GitLab CI/CD (устарело)
https://docs.gitlab.com/ee/development/cicd/templates.html

</details>


<details>
<summary> простой yaml сгеренированй AI  </summary>

Чтобы добавить в `.gitlab-ci.yml` этап запуска сборки через make из папки code-samples, нужно добавить новый этап и задание в файл `.gitlab-ci.yml`, указав команду `make` внутри соответствующей директории, например, так:   
```yaml
stages:
  - build

build_job:
  stage: build
  script:
    - cd code-samples # Переходим в папку с примерами
    - make build # Запускаем сборку через make
  # Опционально: указываем, что сборка должна выполняться в этой папке
  # before_script:
  #   - cd code-samples
```

Пояснения:
> **stages:** Определяет последовательность этапов конвейера. В данном случае есть только один этап — build.  
> **build_job:** Название вашего задания сборки.  
>  **stage: build:** Привязывает это задание к этапу build. 
>  **script:** Содержит список команд, которые будут выполнены.  
>**cd code-samples:** Эта команда переходит в директорию code-samples, где находится ваш Makefile.  
> **make build:** Эта команда запускает сборку, как определено в Makefile (предполагая, что там есть цель с названием build). Если ваша цель сборки называется по-другому, замените build на соответствующее имя.  
> **before_script** (закомментировано): Если вы хотите, чтобы команда cd выполнялась всегда перед скриптом задания, вы можете раскомментировать блок before_script. В данном случае, если make build корректно написан в Makefile, то cd лучше поместить непосредственно перед make.

</details>
